function asyncGeneratorStep(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){c(a);return}if(h.done){b(i)}else{Promise.resolve(i).then(d,e)}}function _asyncToGenerator(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){var h=a.apply(b,c);function f(a){asyncGeneratorStep(h,d,e,f,g,"next",a)}function g(a){asyncGeneratorStep(h,d,e,f,g,"throw",a)}f(void 0)})}}define ("quizaccess_proctoring/startAttempt",["jquery","core/ajax","core/notification"],function(a,b,c){return{setup:function setup(d){window.share_state=document.getElementById("share_state");window.window_surface=document.getElementById("window_surface");window.screenoff=document.getElementById("screen_off_flag");var h=document.getElementById("video-screen"),i=document.getElementById("log-screen"),j={video:{cursor:"always"},audio:!1};a("#share_screen_btn").click(function(){event.preventDefault();e();a("#form_activate").css("visibility","visible")});a("#fcvalidate").click(function(){event.preventDefault();var d=document.getElementById("photo"),e=document.getElementById("canvas"),f=document.getElementById("video"),g=e.getContext("2d");g.drawImage(f,0,0,e.width,e.height);var h=e.toDataURL("image/png");d.setAttribute("src",h);var i=document.getElementById("courseidval").value,j=document.getElementById("cmidval").value,k=document.getElementById("profileimage").value;document.getElementById("loading_spinner").style.display="block";b.call([{methodname:"quizaccess_proctoring_validate_face",args:{courseid:i,cmid:j,profileimage:k,webcampicture:h}}])[0].done(function(b){if(1>b.warnings.length){document.getElementById("loading_spinner").style.display="none";var d=b.status;if("success"==d){a("#video").css("border","10px solid green");document.getElementById("fcvalidate").style.display="none";document.getElementById("share_screen_btn").style.display="block"}else{a("#video").css("border","10px solid red")}}else{document.getElementById("loading_spinner").style.display="none";if(f){c.addNotification({message:"Something went wrong during taking the image.",type:"error"})}}}).fail(c.exception)});function e(){return f.apply(this,arguments)}function f(){f=_asyncToGenerator(regeneratorRuntime.mark(function a(){var b;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:i.innerHTML="";a.prev=1;a.next=4;return navigator.mediaDevices.getDisplayMedia(j);case 4:h.srcObject=a.sent;g();a.next=14;break;case 8:a.prev=8;a.t0=a["catch"](1);b=a.t0.toString();if(!("NotAllowedError: Permission denied"==b)){a.next=14;break}alert("Please share entire screen.");return a.abrupt("return",!1);case 14:case"end":return a.stop();}}},a,null,[[1,8]])}));return f.apply(this,arguments)}function g(){}var k=setInterval(function takeScreenshot(){var a=document.getElementById("screen_off_flag").value;if(null!==h.srcObject){var e=h.srcObject.getVideoTracks()[0],f=h.srcObject,g=f.active,i=e.getSettings(),j=i.displaySurface;if("0"==a){if(!g){alert("Sorry !! You need to restart the attempt as you have stopped the screenshare.");clearInterval(k);window.close();return!1}if("monitor"!==j){alert("Sorry !! You need to share entire screen.");clearInterval(k);window.close();return!1}}var l=document.getElementById("video-screen"),m=document.getElementById("canvas-screen"),n=m.getContext("2d");m.width=screen.width;m.height=screen.height;n.drawImage(l,0,0,screen.width,screen.height);var o=m.toDataURL("image/png"),p={courseid:d.courseid,screenshotid:d.id,quizid:d.cmid,webcampicture:o,imagetype:2};if("0"==a){b.call([{methodname:"quizaccess_proctoring_send_camshot",args:p}])[0].done(function(a){if(!(1>a.warnings.length)){if(l){c.addNotification({message:"Something went wrong during taking the image.",type:"error"});clearInterval(k)}}}).fail(c.exception)}}},d.screenshotinterval),l=setInterval(function updateWindowStatus(){if(null!==h.srcObject){var a=h.srcObject.getVideoTracks()[0],b=h.srcObject,c=b.active,d=a.getSettings(),e=d.displaySurface;document.getElementById("window_surface").value=e;document.getElementById("share_state").value=c;var f=document.getElementById("screen_off_flag").value;if("1"==f){a.stop();clearInterval(l);location.reload()}}},1e3);return!0}}});
//# sourceMappingURL=startAttempt.min.js.map
