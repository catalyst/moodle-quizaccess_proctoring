var isCameraAllowed=!1;define ("quizaccess_proctoring/proctoring",["jquery","core/ajax","core/notification"],function(a,b,c){a(function(){a("#id_submitbutton").prop("disabled",!0);a("#id_proctoring").on("change",function(){if(this.checked&&isCameraAllowed){a("#id_submitbutton").prop("disabled",!1)}else{a("#id_submitbutton").prop("disabled",!0)}})});function d(){a(".mod_quiz-next-nav").prop("disabled",!0);a(".submitbtns").html("<p class=\"text text-red red\">You need to enable web camera before submitting this quiz!</p>")}var e=3e4;return{setup:function setup(f){e=f.camshotdelay;if(null!==document.getElementById("page-mod-quiz-summary")&&document.getElementById("page-mod-quiz-summary").innerHTML.length){return!1}if(null!==document.getElementById("page-mod-quiz-review")&&document.getElementById("page-mod-quiz-review").innerHTML.length){return!1}var h=f.image_width,i=0,j=!1,k=null;a("#mod_quiz_navblock").append("<div class=\"card-body p-3\"><h3 class=\"no text-left\">Webcam</h3> <br/><video id=\"video\">Video stream not available.</video><canvas id=\"canvas\" style=\"display:none;\"></canvas><div class=\"output\" style=\"display:none;\"><img id=\"photo\" alt=\"The picture will appear in this box.\"/></div></div>");var l=document.getElementById("video"),m=document.getElementById("canvas"),n=document.getElementById("photo"),o=function(){var a=m.getContext("2d");a.fillStyle="#AAA";a.fillRect(0,0,m.width,m.height);k=m.toDataURL("image/png");n.setAttribute("src",k)},p=function(){var a=m.getContext("2d");if(h&&i){m.width=h;m.height=i;a.drawImage(l,0,0,h,i);k=m.toDataURL("image/png");n.setAttribute("src",k);f.webcampicture=k;var d={courseid:f.courseid,screenshotid:f.id,quizid:f.quizid,webcampicture:k,imagetype:1};b.call([{methodname:"quizaccess_proctoring_send_camshot",args:d}])[0].done(function(a){if(!(1>a.warnings.length)){if(l){c.addNotification({message:"Something went wrong during taking the image.",type:"error"})}}}).fail(c.exception)}else{o()}};navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then(function(a){l.srcObject=a;l.play();isCameraAllowed=!0}).catch(function(){d()});if(l){l.addEventListener("canplay",function(){if(!j){i=l.videoHeight/(l.videoWidth/h);if(isNaN(i)){i=h/(4/3)}l.setAttribute("width",h);l.setAttribute("height",i);m.setAttribute("width",h);m.setAttribute("height",i);j=!0}},!1);l.addEventListener("click",function(a){p();a.preventDefault()},!1);setTimeout(p,3000);setInterval(p,e)}else{d()}var q=f.quizurl;function g(){if("undefined"!=typeof window.opener&&null!==window.opener){if(window.opener.closed){window.close()}}else{window.close()}var a=window.opener.location.href;if(!a.includes(q)){window.close()}var b=window.opener.share_state,c=window.opener.window_surface;if("true"!==b.value){window.close()}if("monitor"!==c.value){window.close()}}if("yes"==f.enablescreenshare){a(window).ready(function(){setInterval(g,1e3)})}a("#responseform").submit(function(){var a=document.getElementsByName("nextpage"),b=0;if(0<a.length){b=a[0].value}if("-1"===b){window.opener.screenoff.value="1"}});return!0},init:function init(d){var i=0,j=!1,k=null,l=null,m=null,n=null;function e(a){k=document.getElementById("video");l=document.getElementById("canvas");m=document.getElementById("photo");if(k){navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then(function(a){k.srcObject=a;k.play();isCameraAllowed=!0}).catch(function(){c.addNotification({message:a.allowcamerawarning,type:"warning"});h()});k.addEventListener("canplay",function(){if(!j){i=k.videoHeight/(k.videoWidth/320);if(isNaN(i)){i=240}k.setAttribute("width",320);k.setAttribute("height",i);l.setAttribute("width",320);l.setAttribute("height",i);j=!0}},!1);k.addEventListener("click",function(a){g();a.preventDefault()},!1)}else{h()}f()}function f(){if(isCameraAllowed){var a=l.getContext("2d");a.fillStyle="#AAA";a.fillRect(0,0,l.width,l.height);n=l.toDataURL("image/png");m.setAttribute("src",n)}else{h()}}function g(){var a=l.getContext("2d");if(i){l.width=320;l.height=i;a.drawImage(k,0,0,320,i);n=l.toDataURL("image/png");m.setAttribute("src",n);var e={courseid:d.courseid,screenshotid:d.id,quizid:d.quizid,webcampicture:n,imagetype:1};b.call([{methodname:"quizaccess_proctoring_send_camshot",args:e}])[0].done(function(a){if(!(1>a.warnings.length)){c.addNotification({message:"Something went wrong during taking screenshot.",type:"error"})}}).fail(c.exception)}else{f()}}function h(){a(".mod_quiz-next-nav").prop("disabled",!0);a(".submitbtns").html("<p class=\"text text-red red\">You need to enable web camera before submitting this quiz!</p>")}e();return n}}});
//# sourceMappingURL=proctoring.min.js.map
